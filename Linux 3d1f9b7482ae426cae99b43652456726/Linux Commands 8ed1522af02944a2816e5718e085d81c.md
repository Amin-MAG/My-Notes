# Linux Commands

## Create link

```bash
ln -s /root/B/publicB.pem
```

## Kill a process on a port

```bash
sudo kill -9 $(sudo lsof -t -i:3000)
```

## Find files

```bash
# Files that have flag in their names
find . -iname '*flag*'
```

## Search in contents

```bash
# Search in all files and contents
grep -r flag *

# For non-sensetive
grep -i
```

## Binaries

```bash
# To see human readble strings in binary files
strings <BINARY_FILE>
```

## List folders sizes

```bash
du -sh *
```

If you want to sort them, you can use the `sort` command.

```bash
du -hs * | sort -h
```

An alternative for the `du` is the `ncdu`:

```bash
ncdu
```

## Common tricks

To check if a bash script is correct or not without running it:

```bash
bash -n <script>
```

Use -p flag when you want to create nested folders. For example:

```bash
mkdir -p a/b/c/d/e/f/g
```

To calculate the duration of a command

```matlab
time <YOUR_COMMMAND>
```

## Tree the folders 2 levels

```bash
tree -L 2 .
```

## Install DPKG dependencies

```bash
# First, install the DPKG
sudo dpkg -i package_with_unsatisfied_dependencies.deb

# Run this command to satisfy the dependencies
apt-get -f install
```

## Environment variables

Import environment variables from a file.

`set -a` causes variables defined from now on to be automatically exported. It's available in any Bourne-like shell. `.` is the standard and Bourne name for the `source` command so I prefer it for portability (`source` comes from `csh` and is now available in most modern Bourne-like shells including `bash` though (sometimes with a slightly different behavior)).

```bash
set -a
source ./tmp.txt
set +a
```

You can create a template file like bellow

```bash
Package: SPCU-Client
Version: $VERSION
Architecture: armhf
Maintainer: SPCUINC <Admin@spcuinc.com>
Description: A program managing IoT devices.
```

Then you can replace the environment variables to generate a new config file.

```bash
envsubst < "configs/control" > "build/spcu_client_1.0.0-1_armhf/DEBIAN/control"
```

## chgrp

To change group owner ship

```bash
# Change group of /u to staff
chgrp staff /u
# + With subfolders (recursively)
chgrp -hR staff /u
```

## chmod

It restricts the way a file can be accessed.

```bash
# chmod options permissions file name

# the user can read, write, and execute it;
# members of your group can read and execute it; and
# others may only read it.
chmod u=rwx,g=rx,o=r myfile
chmod 754 myfile
```

The operator **+** causes the selected file mode bits to be added to the existing file mode bits of each file; **** causes them to be removed; and **=** causes them to be added and causes unmentioned bits to be removed except that a directory's unmentioned set user and group ID bits are not affected.

## Sed

It is a command used for replacing and editing strings. For instance, look at this text:

```
# text.txt file
unix is great os. linux is opensource. unix is free os.
learn operating system.
unix linux which one you choose.
unix is easy to learn.linux is a multiuser os.Learn unix .unix is a powerful.
```

You can replace all of UNIX works to Linux by this command:

```bash
# `s` is for substitution
# First one is the word going to be substituted
# The second word is the new work
# There are bunch of flags like g that means global.
# You can use `2` for changing the second occurnance.
sed 's/unix/linux/g' geekfile.txt
```

## Curl

For a get request:

```bash
curl -X GET <URL>
curl -i -H "Accept: application/json" -H "Content-Type: application/json" -X GET http://hostname/resource
```

To beautify the response you can:

```bash
echo $(curl -X GET http://localhost:8000/revert/minio/3/) | python -m json.tool
```

# Script

```bash
# Loop through the lines of a file
while read p; do
  echo "$p"
done <peptides.txt
```

# Tar

## Extracting `.tar` files

To extract a `tar.gz` file, use the --extract (`-x`) option and specify the archive file name after the f option:

```bash
tar -xf archive.tar.gz
```

The `-v` option will make the tar command more visible and print the names of the files being extracted on the terminal.

By default, tar will extract the archive contents in the current working directory. Use the `--directory` (`-C`) to extract archive files in a specific directory:

```bash
tar -xf archive.tar.gz -C /home/linuxize/files
```

When extracting files, you must provide their exact names including the path, as printed by `--list` (`-t`).

Extracting one or more directories from an archive is the same as extracting files:

```bash
tar -xf archive.tar.gz dir1 dir2Copy
```

# Cron

## Basic syntax

***Cron*** reads the configuration files for a list of commands to execute. The daemon uses a specific syntax to interpret the lines in the ***crontab*** configuration tables.

To be able to set up a cron job, we need to understand the basic elements that make up this syntax. The standard form for a crontab line is as follows:

```bash
a b c d e /directory/command output

# Another pattern naming
MIN HOUR DOM MON DOW CMD
# MIN	Minute field	0 to 59
# HOUR	Hour field	0 to 23
# DOM	Day of Month	1-31
# MON	Month field	1-12
# DOW	Day Of Week	0-6
# CMD	Command	Any command to be executed
```

1. The first five fields **`a b c d e`** specify the time/date and recurrence of the job. See the table for further information.  [https://phoenixnap.com/kb/set-up-cron-job-linux](https://phoenixnap.com/kb/set-up-cron-job-linux)

2. In the second section, the **`/directory/command`** specifies the location and script you want to run.

3. The final segment **`output`** is optional. It defines how the system notifies the user of the job completion.

For example, if I want to run the script `run.sh`:

```bash
# Open the configuration file
crontab -e

# Add the line to the file
# It will run the script each miniute
# The current path that runs the script is /home/<username>
# The third option is optional and gathers the output in a file
* * * * * /home/ubuntu/cron/run.sh /home/ubuntu/cron/
```

## Special characters

For efficiency, cron syntax also uses operators. Operators are special characters that perform operations on the provided values in the cron field.

- **An asterisk (*)** stands for all values. Use this operator to keep tasks running during all months, or all days of the week.
- **A comma (,)** specifies separate individual values.
- **A dash (–)** indicates a range of values.
- **A forward-slash (/)** is used to divide a value into steps. (*/2 would be every other value, */3 would be every third, */10 would be every tenth, etc.)

### Time Special values

[https://www.thegeekstuff.com/2009/06/15-practical-crontab-examples/](https://www.thegeekstuff.com/2009/06/15-practical-crontab-examples/)

```bash
# Keyword	Equivalent
# @yearly	0 0 1 1 *
# @daily	0 0 * * *
# @hourly	0 * * * *
# @reboot	Run at startup.
# For example
@yearly /home/ramesh/red-hat/bin/annual-maintenance
```

## Set Cron job for another user

```bash
crontab –u other_username –e
```

# Network

## IP Address

To get local IP addresses:

```bash
ifconfig
en0: flags=8863<UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST> mtu 1500
	options=400<CHANNEL_IO>
	ether 38:f9:d3:50:53:4f
	inet6 fe80::cd8:50d:9fda:6cfc%en0 prefixlen 64 secured scopeid 0x4
	inet 192.168.1.3 netmask 0xffffff00 broadcast 192.168.1.255
	nd6 options=201<PERFORMNUD,DAD>
	media: autoselect
	status: active

arp -a 
? (192.168.1.1) at e0:1c:fc:6:a4:5c on en0 ifscope [ethernet]
? (192.168.1.3) at 38:f9:d3:50:53:4f on en0 ifscope permanent [ethernet]
? (192.168.1.255) at ff:ff:ff:ff:ff:ff on en0 ifscope [ethernet]
? (239.255.255.250) at 1:0:5e:7f:ff:fa on en0 ifscope permanent [ethernet]

```

### Search all of the active IP Addresses

```bash
# Install the arp-scan
sudo apt-get install arp-scan

# Scan the local IP addresses in network
sudo arp-scan --interface=eth0 --localnet
```

## Block a server

Sometimes you may need to block the connection with specific servers. The file `/etc/hosts` is the one gathering information. If you want to block a server you should add lines to this file.

```jsx
# First open the file
sudo vim /etc/hosts

# Then Add these lines
0.0.0.0   www.example.com
0.0.0.0   example.com
::0       www.example.com
::0       example.com
```

## Set static IP addresses

There are some interfaces. You can change each interface using this command:

```bash
ifconfig <interface> <IP_Address> netmask <Netmask> up
```

For example, it could be like this:

```bash
ifconfig wlan0 192.168.1.5 netmask 255.255.255.0 up
```

To set the default gateway IP:

```bash
route add default gw <IP_Address>
```

## `netcat`

```bash
# Install the netcat
sudo apt install netcat

# nc -v -n -z -w1 <DomainName> <StartPortNo-EndPortNo>
# For instance, in our example, we had the following:
nc -v -n -z w1 192.168.133.128 1-100

#
netstat -na
nc -u <IP> <PORT>
```

## DNS file `resolv.conf`

The `/etc/resolv.conf` configuration file contains information that allows a computer to convert alpha-numeric domain names into numeric IP addresses.

The process of converting domain names to IP addresses is called **resolving**.

> When using DHCP, **`dhclient`** usually rewrites **`resolv.conf`** with information received from the DHCP server.
> 

There are three main configuration directives in `/etc/resolv.conf`:

```
nameserver # DNS server IP
domain # Domain Name of local host
search # Which Domain to search
```

### Nameserver

The `nameserver` directive points out to the IP address of a Name Server.

```
nameserver <IP address>
```

It can be your own Name Server, some [public Name Server](https://www.shellhacks.com/en/Free-Fast-Public-DNS-Servers), or the Name Server of your’s ISP.

> Note: Up to 3 name servers may be listed.
> 

Example:

```
nameserver 192.168.0.100
nameserver 8.8.8.8
nameserver 8.8.4.4
```

### Domain

Local domain name.

```
domain <local domain name>
```

Example:

```
domain domain.com
nameserver 192.168.0.100
nameserver 8.8.4.4
```

How does the “domain” directive in the `resolv.conf` file works?

You can use `domain` directives for resolving short host-names – e.g. `test`. So if you have the following in your `/etc/resolv.conf`:

```
domain example.com
```

Then your computer will try to resolve `test.example.com`.

### Search

Search list for hostname lookup. The search list is normally determined from the local domain name but it can be set to a list of domains.

```
search <search list>
```

Example:

```
search example.com company.net
nameserver 192.168.0.100
nameserver 8.8.8.8
```

How does the “search” directive in the `resolv.conf` file works?

You need to use `search` directive for resolving short host-names – e.g. `test`. So if you have the following in your `/etc/resolv.conf`:

```
search example.com company.net
```

Then your computer will try to resolve `test.example.com` followed by `test.company.net`. It will return the first query that was successful.